!function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value" in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}
return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();(function(){function n(e,t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,n),this.browser=e,this.config=t,this.options=this.browser.options,this.prefetched=new Set,this.eventTime=null,this.threshold=1111,this.numOnHover=0}
return t(n,[{key:"init",value:function(){!this.browser.supportsLinkPrefetch()||this.browser.isDataSaverModeOn()||this.browser.isSlowConnection()||(this.regex={excludeUris:RegExp(this.config.excludeUris,"i"),images:RegExp(".("+this.config.imageExt+")$","i"),fileExt:RegExp(".("+this.config.fileExt+")$","i")},this._initListeners(this))}},{key:"_initListeners",value:function(e){-1<this.config.onHoverDelay&&document.addEventListener("mouseover",e.listener.bind(e),e.listenerOptions),document.addEventListener("mousedown",e.listener.bind(e),e.listenerOptions),document.addEventListener("touchstart",e.listener.bind(e),e.listenerOptions)}},{key:"listener",value:function(e){var t=e.target.closest("a"),n=this._prepareUrl(t);if(null!==n)switch(e.type){case "mousedown":case "touchstart":this._addPrefetchLink(n);break;case "mouseover":this._earlyPrefetch(t,n,"mouseout")}}},{key:"_earlyPrefetch",value:function(e,t,n){var i=this,r=setTimeout(function(){if(r=null,0===i.numOnHover)setTimeout(function(){return i.numOnHover=0},1e3);else if(i.numOnHover>i.config.rateThrottle)return;i.numOnHover++,i._addPrefetchLink(t)},this.config.onHoverDelay);e.addEventListener(n,function t(){e.removeEventListener(n,t,{passive:!0}),null!==r&&(clearTimeout(r),r=null)},{passive:!0})}},{key:"_addPrefetchLink",value:function(e){return this.prefetched.add(e.href),new Promise(function(t,n){var i=document.createElement("link");i.rel="prefetch",i.href=e.href,i.onload=t,i.onerror=n,document.head.appendChild(i)}).catch(function(){})}},{key:"_prepareUrl",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":e(t))||!1 in t||-1===["http:","https:"].indexOf(t.protocol))return null;var n=t.href.substring(0,this.config.siteUrl.length),i=this._getPathname(t.href,n),r={original:t.href,protocol:t.protocol,origin:n,pathname:i,href:n+i};return this._isLinkOk(r)?r:null}},{key:"_getPathname",value:function(e,t){var n=t?e.substring(this.config.siteUrl.length):e;return n.startsWith("/")||(n="/"+n),this._shouldAddTrailingSlash(n)?n+"/":n}},{key:"_shouldAddTrailingSlash",value:function(e){return this.config.usesTrailingSlash&&!e.endsWith("/")&&!this.regex.fileExt.test(e)}},{key:"_isLinkOk",value:function(t){return null!==t&&"object"===(void 0===t?"undefined":e(t))&&!this.prefetched.has(t.href)&&t.origin===this.config.siteUrl&&-1===t.href.indexOf("?")&&-1===t.href.indexOf("#")&&!this.regex.excludeUris.test(t.href)&&!this.regex.images.test(t.href)}}],[{key:"run",value:function(){"undefined"!=typeof VietrickPreloadLinksConfig&&new n(new VietrickBrowserCompatibilityChecker({capture:!0,passive:!0}),VietrickPreloadLinksConfig).init()}}]),n})().run()}();
